///|
fnalias @preact.obscure

///|
/// Hooks Demo Component - å±•ç¤ºæ–°å¢çš„ Preact Hooks API åŠŸèƒ½
///
struct HooksDemoProps {} derive(Default)

///|
impl @preact.JsValueTrait for HooksDemoProps with to_value(_self) -> @preact.JsValue {
  @preact.JsObject::new().to_value()
}

///|
impl @preact.JsValueTrait for HooksDemoProps with from_value(
  _value : @preact.JsValue,
) -> HooksDemoProps {
  HooksDemoProps::default()
}

///|
/// ä¸»è¦çš„ Hooks æ¼”ç¤ºç»„ä»¶
fn comp_hooks_demo(_props : HooksDemoProps) -> VirtualNode {
  // åŸºç¡€çŠ¶æ€ç®¡ç†
  let (count, set_count) = @preact.use_state(0)
  let (message, set_message) = @preact.use_state("åˆå§‹æ¶ˆæ¯")
  let (timer_count, set_timer_count) = @preact.use_state(0)

  // æ¼”ç¤º use_effect_once - ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
  @preact.use_effect_once(fn() {
    println("ğŸ¯ Hooks Demo ç»„ä»¶å·²æŒ‚è½½ï¼")
    set_message("ç»„ä»¶å·²æˆåŠŸæŒ‚è½½")
  })

  // æ¼”ç¤º use_effect_deps - ä¾èµ–äº count å˜åŒ–
  @preact.use_effect_deps(
    fn() {
      println("ğŸ“Š è®¡æ•°å™¨å˜åŒ–: \{count}")
      if count > 0 {
        set_message("è®¡æ•°å™¨å·²æ›´æ–°åˆ°: \{count}")
      }
    },
    [count |> obscure],
  )

  // æ¼”ç¤º use_ref - åˆ›å»ºä¸€ä¸ªå¯å˜å¼•ç”¨
  let timer_ref = @preact.use_ref(0)

  // æ¼”ç¤º use_memo_deps - è®¡ç®—æ˜‚è´µçš„å€¼
  let expensive_value = @preact.use_memo_deps(
    fn() {
      println("ğŸ§® é‡æ–°è®¡ç®—æ˜‚è´µçš„å€¼...")
      count * count + count * 10
    },
    [count |> obscure],
  )

  // æ¼”ç¤º use_callback_deps - ç¼“å­˜å›è°ƒå‡½æ•°
  let increment_callback = @preact.use_callback_deps(
    fn() { set_count(count + 1) },
    [count |> obscure],
  )

  // å®šæ—¶å™¨æ•ˆæœ - æ¼”ç¤ºæ›´å¤æ‚çš„ useEffect ç”¨æ³•
  @preact.use_effect_deps(
    fn() {
      if timer_count < 10 {
        // æ¨¡æ‹Ÿå®šæ—¶å™¨æ•ˆæœ
        println("â° å®šæ—¶å™¨: \{timer_count}")
      }
    },
    [timer_count |> obscure],
  )
  @preact.div(
    style=respo_style(
      padding=20.0 |> Px,
      margin=10.0 |> Px,
      background_color=Hsl(120, 20, 95),
    ),
    [
      @preact.h2([Text("ğŸ£ Preact Hooks API æ¼”ç¤º")]),

      // çŠ¶æ€å±•ç¤ºåŒºåŸŸ
      @preact.div(style=@css.respo_style(margin_bottom=15.0 |> @css.Px), [
        @preact.h3([Text("ğŸ“Š çŠ¶æ€ä¿¡æ¯")]),
        @preact.p([Text("å½“å‰è®¡æ•°: \{count}")]),
        @preact.p([Text("æ¶ˆæ¯: \{message}")]),
        @preact.p([Text("è®¡ç®—å€¼ (countÂ² + countÃ—10): \{expensive_value}")]),
        @preact.p([Text("å®šæ—¶å™¨è®¡æ•°: \{timer_count}")]),
      ]),

      // æ“ä½œæŒ‰é’®åŒºåŸŸ
      @preact.div(style=@css.respo_style(margin_bottom=15.0 |> @css.Px), [
        @preact.h3([Text("ğŸ® æ“ä½œæ§åˆ¶")]),
        @preact.button(
          on_click=fn(_e) { increment_callback() },
          style=@css.respo_style(
            margin_right=10.0 |> @css.Px,
            padding=8.0 |> @css.Px,
            background_color=@css.Hsl(200, 70, 50),
            color=@css.White,
            border_radius=4.0,
            cursor=Pointer,
            // border=None,
          ),
          [Text("å¢åŠ è®¡æ•° (+1)")],
        ),
        @preact.button(
          on_click=fn(_) {
            set_count(0)
            set_message("è®¡æ•°å™¨å·²é‡ç½®")
          },
          style=@css.respo_style(
            margin_right=10.0 |> @css.Px,
            padding=8.0 |> @css.Px,
            background_color=@css.Hsl(0, 70, 50),
            color=@css.White,
            border_radius=4.0,
            cursor=Pointer,
          ),
          [Text("é‡ç½®è®¡æ•°")],
        ),
        @preact.button(
          on_click=fn(_) {
            let current = timer_ref.get()
            let new_val = current + 1
            timer_ref.set(new_val)
            set_timer_count(new_val)
          },
          style=@css.respo_style(
            padding=8.0 |> @css.Px,
            background_color=@css.Hsl(120, 70, 40),
            color=@css.White,
            border_radius=4.0,
            cursor=Pointer,
          ),
          [Text("å¯åŠ¨å®šæ—¶å™¨")],
        ),
      ]),

      // åŠŸèƒ½è¯´æ˜åŒºåŸŸ
      @preact.div(
        style=@css.respo_style(
          background_color=@css.Hsl(60, 30, 95),
          padding=15.0 |> Px,
          border_radius=6.0,
          border=CssBorder(1.0, Solid, @css.Hsl(60, 30, 80)),
        ),
        [
          @preact.h3([Text("ğŸ“š åŠŸèƒ½è¯´æ˜")]),
          @preact.ul([
            @preact.li([
              Text(
                "ğŸ¯ use_effect_once: ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—",
              ),
            ]),
            @preact.li([
              Text(
                "ğŸ“Š use_effect_deps: ä¾èµ–è®¡æ•°å™¨å˜åŒ–ï¼Œæ¯æ¬¡ç‚¹å‡»å¢åŠ éƒ½ä¼šè§¦å‘",
              ),
            ]),
            @preact.li([
              Text(
                "ğŸ§® use_memo_deps: ç¼“å­˜è®¡ç®—ç»“æœï¼Œåªåœ¨è®¡æ•°å˜åŒ–æ—¶é‡æ–°è®¡ç®—",
              ),
            ]),
            @preact.li([
              Text("ğŸ® use_callback_deps: ç¼“å­˜å›è°ƒå‡½æ•°ï¼Œä¼˜åŒ–æ€§èƒ½"),
            ]),
            @preact.li([
              Text("ğŸ“ use_ref: åˆ›å»ºå¯å˜å¼•ç”¨ï¼Œç”¨äºå®šæ—¶å™¨è®¡æ•°"),
            ]),
          ]),
        ],
      ),
    ],
  )
}
