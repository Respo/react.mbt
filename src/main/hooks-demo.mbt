///|
fnalias @react.obscure

///|
/// Hooks Demo Component - å±•ç¤ºæ–°å¢çš„ React Hooks API åŠŸèƒ½
///
struct HooksDemoProps {} derive(Default)

///|
impl @react.JsValueTrait for HooksDemoProps with to_value(_self) -> @react.JsValue {
  @react.JsObject::new().to_value()
}

///|
impl @react.JsValueTrait for HooksDemoProps with from_value(
  _value : @react.JsValue,
) -> HooksDemoProps {
  HooksDemoProps::default()
}

///|
/// ä¸»è¦çš„ Hooks æ¼”ç¤ºç»„ä»¶
fn comp_hooks_demo(_props : HooksDemoProps) -> VirtualNode {
  // åŸºç¡€çŠ¶æ€ç®¡ç†
  let (count, set_count) = @react.use_state(0)
  let (message, set_message) = @react.use_state("åˆå§‹æ¶ˆæ¯")
  let (timer_count, set_timer_count) = @react.use_state(0)

  // æ¼”ç¤º use_effect_once - ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
  @react.use_effect_once(fn() {
    println("ğŸ¯ Hooks Demo ç»„ä»¶å·²æŒ‚è½½ï¼")
    set_message("ç»„ä»¶å·²æˆåŠŸæŒ‚è½½")
  })

  // æ¼”ç¤º use_effect_deps - ä¾èµ–äº count å˜åŒ–
  @react.use_effect_deps(
    fn() {
      println("ğŸ“Š è®¡æ•°å™¨å˜åŒ–: \{count}")
      if count > 0 {
        set_message("è®¡æ•°å™¨å·²æ›´æ–°åˆ°: \{count}")
      }
    },
    [count |> obscure],
  )

  // æ¼”ç¤º use_ref - åˆ›å»ºä¸€ä¸ªå¯å˜å¼•ç”¨
  let timer_ref = @react.use_ref(0)

  // æ¼”ç¤º use_memo_deps - è®¡ç®—æ˜‚è´µçš„å€¼
  let expensive_value = @react.use_memo_deps(
    fn() {
      println("ğŸ§® é‡æ–°è®¡ç®—æ˜‚è´µçš„å€¼...")
      count * count + count * 10
    },
    [count |> obscure],
  )

  // æ¼”ç¤º use_callback_deps - ç¼“å­˜å›è°ƒå‡½æ•°
  let increment_callback = @react.use_callback_deps(
    fn() { set_count(count + 1) },
    [count |> obscure],
  )

  // å®šæ—¶å™¨æ•ˆæœ - æ¼”ç¤ºæ›´å¤æ‚çš„ useEffect ç”¨æ³•
  @react.use_effect_deps(
    fn() {
      if timer_count < 10 {
        // æ¨¡æ‹Ÿå®šæ—¶å™¨æ•ˆæœ
        println("â° å®šæ—¶å™¨: \{timer_count}")
      }
    },
    [timer_count |> obscure],
  )
  @react.div(
    style=respo_style(
      padding=20.0 |> Px,
      margin=10.0 |> Px,
      background_color=Hsl(120, 20, 95),
    ),
    [
      @react.h2([@react.Text("ğŸ£ React Hooks API æ¼”ç¤º")]),

      // çŠ¶æ€å±•ç¤ºåŒºåŸŸ
      @react.div(style=@css.respo_style(margin_bottom=15.0 |> @css.Px), [
        @react.h3([@react.Text("ğŸ“Š çŠ¶æ€ä¿¡æ¯")]),
        @react.p([@react.Text("å½“å‰è®¡æ•°: \{count}")]),
        @react.p([@react.Text("æ¶ˆæ¯: \{message}")]),
        @react.p([@react.Text("è®¡ç®—å€¼ (countÂ² + countÃ—10): \{expensive_value}")]),
        @react.p([@react.Text("å®šæ—¶å™¨è®¡æ•°: \{timer_count}")]),
      ]),

      // æ“ä½œæŒ‰é’®åŒºåŸŸ
      @react.div(style=@css.respo_style(margin_bottom=15.0 |> @css.Px), [
        @react.h3([@react.Text("ğŸ® æ“ä½œæ§åˆ¶")]),
        @react.button(
          on_click=fn(_e) { increment_callback() },
          style=@css.respo_style(
            margin_right=10.0 |> @css.Px,
            padding=8.0 |> @css.Px,
            background_color=@css.Hsl(200, 70, 50),
            color=@css.White,
            border_radius=4.0,
            cursor=Pointer,
            // border=None,
          ),
          [@react.Text("å¢åŠ è®¡æ•° (+1)")],
        ),
        @react.button(
          on_click=fn(_) {
            set_count(0)
            set_message("è®¡æ•°å™¨å·²é‡ç½®")
          },
          style=@css.respo_style(
            margin_right=10.0 |> @css.Px,
            padding=8.0 |> @css.Px,
            background_color=@css.Hsl(0, 70, 50),
            color=@css.White,
            border_radius=4.0,
            cursor=Pointer,
          ),
          [@react.Text("é‡ç½®è®¡æ•°")],
        ),
        @react.button(
          on_click=fn(_) {
            let current = timer_ref.get()
            let new_val = current + 1
            timer_ref.set(new_val)
            set_timer_count(new_val)
          },
          style=@css.respo_style(
            padding=8.0 |> @css.Px,
            background_color=@css.Hsl(120, 70, 40),
            color=@css.White,
            border_radius=4.0,
            cursor=Pointer,
          ),
          [@react.Text("å¯åŠ¨å®šæ—¶å™¨")],
        ),
      ]),

      // åŠŸèƒ½è¯´æ˜åŒºåŸŸ
      @react.div(
        style=@css.respo_style(
          background_color=@css.Hsl(60, 30, 95),
          padding=15.0 |> Px,
          border_radius=6.0,
          border=CssBorder(1.0, Solid, @css.Hsl(60, 30, 80)),
        ),
        [
          @react.h3([@react.Text("ğŸ“š åŠŸèƒ½è¯´æ˜")]),
          @react.ul([
            @react.li([
              @react.Text(
                "ğŸ¯ use_effect_once: ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—",
              ),
            ]),
            @react.li([
              @react.Text(
                "ğŸ“Š use_effect_deps: ä¾èµ–è®¡æ•°å™¨å˜åŒ–ï¼Œæ¯æ¬¡ç‚¹å‡»å¢åŠ éƒ½ä¼šè§¦å‘",
              ),
            ]),
            @react.li([
              @react.Text(
                "ğŸ§® use_memo_deps: ç¼“å­˜è®¡ç®—ç»“æœï¼Œåªåœ¨è®¡æ•°å˜åŒ–æ—¶é‡æ–°è®¡ç®—",
              ),
            ]),
            @react.li([
              @react.Text("ğŸ® use_callback_deps: ç¼“å­˜å›è°ƒå‡½æ•°ï¼Œä¼˜åŒ–æ€§èƒ½"),
            ]),
            @react.li([
              @react.Text("ğŸ“ use_ref: åˆ›å»ºå¯å˜å¼•ç”¨ï¼Œç”¨äºå®šæ—¶å™¨è®¡æ•°"),
            ]),
          ]),
        ],
      ),
    ],
  )
}
